<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="液氮腾,794200196@qq.com"><title>Hello World · 液氮腾</title><meta name="description" content="其实此题并非很难的嘛，宝宝这就讲一下啦~首先用IDA载入，审阅左侧函数名列表，看到第一个函数就是DialogFunc，顾名思义为“对话函数”，极有可能负责了交互界面的相关功能，我们双击它，看到右侧汇编区域中出现“密钥无效”（“密钥无效”存储在变量aZgb里）等敏感字符串，这正是出现在交互窗口中的信息"><meta name="keywords" content="液氮腾,CTF,Writeup,UP"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">液氮腾</a></h3><div class="description"><p>这个人很懒,什么都没留下</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">Sobre</a></li><li><a href="/archives">Arquivo</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="https://s.gravatar.com/avatar/9d0016d5cce4d742ce7f8ee4b471354e?s=240"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Hello World</a></h3></div><div class="post-content"><p>其实此题并非很难的嘛，宝宝这就讲一下啦~<br>首先用IDA载入，审阅左侧函数名列表，看到第一个函数就是DialogFunc，顾名思义为“对话函数”，极有可能负责了交互界面的相关功能，我们双击它，看到右侧汇编区域中出现“密钥无效”（“密钥无效”存储在变量aZgb里）等敏感字符串，这正是出现在交互窗口中的信息，我们自然而然想到去分析返回“密钥无效”这一信息的逻辑判断的相关算法，我们F5看看DialogFunc的源码：<br><img src="http://gitbookfordt.test.upcdn.net/gaiti001.png" alt="图1"><br>发现这里有一个if判断（这里当然指的是内层那个啦),在<code>!sub_4011D0()</code>的值为false 即0时，就会弹出消息框，内容是<code>aZgb</code>即<code>密钥无效</code>，也就是说，当输入正确的注册码（即flag）时,<code>!sub_4011D0()</code>值就会是1，即<code>sub_4011D0()</code>的返回值为0，我们要做的就是分析一下怎么才能让<code>sub_4011D0()</code>返回0。<br>查看<code>sub_4011D0()</code>的源码：<br><img src="http://gitbookfordt.test.upcdn.net/gaiti002.png" alt="图2"><br>其中，有两个GetDlgItemTextA，第一个是读取用户名，第二个是读取注册码；我们现在来看返回值，是result，我们期望result的值是0，那么执行外层if时，条件应成立，实际上用户名是hello时已经能保证成立了，这个很明显，所以关键就是分析内层的逻辑，内层的那个if其实又是句没用的废话…这里真正关键的问题在于，让result的值是0，即：</p>
<p>lstrcmpA(&amp;String1, String) != 0的值是0，即lstrcmpA(&amp;String1, String)的值是0，即string1等于string，此处lstrcmp函数的功能大家自己查百度不难了解到，不懂的朋友自己去看一下很容易就看懂了。那么string1就是输入的注册码也就是我们的flag，也就是说正确的flag就是string，我们只要分析出string这一字符串到底是什么就OK了。注意，开始的时候string就是用户名hello，但是就在最后关头，一个字符串尾接函数lstrcatA已经将string改变了，所做的改变就是在原来的“hello”后面接上了字符串string2，于是，现在的任务又变成了确定string2的值，那么string2的值是怎么确定的呢？正是上面那段while循环的算法，我们下面给出这段的截图：<br><img src="http://gitbookfordt.test.upcdn.net/gaiti003.png" alt="图3"><br>算法对string的每个字符进行计算，结果赋给string2的对应字符，就把string2算出来了，我写出了对应的C语言代码：  </p>
<pre><code class="C"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span>
<span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>{
  <span class="keyword">int</span> a[<span class="number">5</span>];
  <span class="keyword">int</span> r[<span class="number">5</span>];
  <span class="keyword">int</span> i;
  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">4</span>;i++){
      a[i]=getchar();
      r[i]=<span class="number">0</span>;
  }
  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">4</span>;i++){
      r[i]=(i+ i*a[i]*a[i]) % <span class="number">66</span> + <span class="number">33</span>;
  }
  <span class="built_in">printf</span>(<span class="string">"\n"</span>);
  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">4</span>;i++){
      <span class="built_in">printf</span>(<span class="string">"%c"</span>,r[i]);   
  }
}
</code></pre>
<p>运行程序输入“hello”，就会打印正确的string2：<br><img src="http://gitbookfordt.test.upcdn.net/gaiti004.png" alt="图4"><br>所以string的值就是“hello!GAOU”，即flag~~~</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-11-09</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2018/11/09/该题不简单-----IDA算法分析/,液氮腾,Hello World,;"></a></div></div><div class="pagination"><ul class="clearfix"></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>